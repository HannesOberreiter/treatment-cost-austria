```{r r-result, warning=F, echo=F, include=F}
# source("src/r-plot-distr-year.R", local = knitr::knit_global())
# source("src/r-plot-distr-groups.R", local = knitr::knit_global())
# source("src/r-bland-altman.R", local = knitr::knit_global())

# source("src/r-operation-size.R",    local = knitr::knit_global())
# source("src/r-migratory.R",         local = knitr::knit_global())
# source("src/r-cert-org.R",          local = knitr::knit_global())

# source("src/r-factor.R", local = knitr::knit_global())
# source("src/r-extrapolation.R", local = knitr::knit_global())
# source("src/r-loss-expenses.R", local = knitr::knit_global())
```

# Results
## Survey Data
### Representative and distribution of sample

```{r, include=FALSE}
source("src/r-survey.R", local = knitr::knit_global())
```

Compared to the number of registered beekeeper and honey bee colonies with the reported numbers from the national beekeeping association "Biene Österreich"[^r-vis], the number of participation with valid answers including costs for survey year 2018/19 with `r r_survey$response$rate_beekeeper[[1]]`%, survey year 2019/20 with `r r_survey$response$rate_beekeeper[[2]]`% and 2020/21 with `r r_survey$response$rate_beekeeper[[3]]`%, see table \@ref(tab:registered). The distribution map of participants shows good coverage all over Austria for all survey years (figure \@ref(fig:distr-map)).

[^r-vis]: In Austria the registration of beekeepers, apiaries and honeybee colonies in the Consumer Health Information System (Verbrauchergesundheitsinformationssystem - VIS) has been implemented into the national Animal Identification and Registration Regulation 2009 (Tierkennzeichnungs- und Registrierungsverordnung, § 1 TKZVO 2009 idF II 193/2015) from 8th of July 2015.

```{r registered, include=T}
cn <- c("Year", "Total", "Survey", "%", "Total", "Survey", "%")
c <- "Percentage of survey participants in relation to the amount of registered beekeepers with the national beekeeping association Biene Österreich (2018 and 2019)."
tab <- knitr::kable(
  r_survey$response %>%
    select(year, beekeeper, survey_beekeeper, rate_beekeeper, colonies, survey_colonies, rate_colonies),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  # format = "markdown",
  caption = c
) %>%
  kableExtra::add_header_above(c("", "Beekeeper [n]" = 3, "Colonies [n]" = 3))
tab
rm(tab, c, cn)
```

```{r distr-map, include=T, fig.cap="Distribution map of approximnate main winter apiary position for our survey participants. Shapefiles under Creative Commons https://www.data.gv.at/"}
knitr::include_graphics("output/figs/map.png")
```

The over all survey years the mean equals to `r r_survey$summary$survey_total$mean` euro and the median to `r r_survey$summary$survey_total$median`, see table \@ref(tab:central). The distribution of treatment expenses per colony is right skewed with high values above 100 euro. The years are similar in their disitrubtion, see figure \@ref(fig:distr-year). The distribution shows that participants preferable answer in round estimates eg. 5.00, 10.00, 15.00 Euros.

```{r distr-year, include=T, messages=F, warnings=F, fig.cap="Disitrubtion of the expenses for each survey year, values above 50 are not visible."}
knitr::include_graphics("output/figs/distr-year.png")
```

```{r central, include=T}
cn <- c("Year", "Minimum", "Mean", "Median", "Max", "n")
c <- "Survey central tendency values for treatment expenses per colony for all years and additionaly over all years."
tab <- knitr::kable(
  dplyr::bind_rows(r_survey$summary$survey_table, r_survey$summary$survey_total) %>%
    select(-type) %>%
    mutate(
      year = ifelse(year == "total", "All Years", paste0("20", year))
    ),
  align = c("l", rep("r", 5)),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  # format = "markdown",
  caption = c
) %>%
  kableExtra::pack_rows(start_row = 1, end_row = 3)
tab
rm(tab, c, cn)
```

### Distribution of Participants in groups of interest

The most common group in the survey are recreational beekeepers, which I defined as participants with 25 or less colonies (figure \@ref(fig:distr-groups)). Second most are beekeepers with more than 25 colonies. Only a small portion of participants are certified organic or migratory beekeepers and even less both combined. The observed distribution is similar over all three survey years, a small decline in recreational beekeepers which are also report to migrate their colonies can be seen.

```{r distr-groups, include=T, messages=F, warnings=F, fig.cap="Count and distribution of participants in groups of interest for each year. Percentage reported stands respectivley for the survey years 2018/19, 2019/20 and 2020/21. Recreational Beekeepers are participants with 25 or less colonies going into winter."}
knitr::include_graphics("output/figs/distr-groups.png")
```

## Expenses Estimations {#r-estimations}

The calculated estimated expenses mean and median are higher than in the survey given by participants, but more similar when compared the two survey years, see table \@ref(tab:table-estimates). The most common combinations, without drone brood removal, for both survey years together and the corresponding estimates can be seen in table \@ref(tab:common-comb). For the tables the estimated expenses are calculated for each beekeeper in the survey and then the average was taken as with the survey expenses.

```{r table-estimates, include=T}
c <- "Comparison of estimated expenses and the expenses given by participants in the survey. All values are in Euro."

print_table <- rbind(SUMMARY_expenses$estimate_table, SUMMARY_expenses$expenses_table) %>%
  arrange(c(1, 3, 2, 4))

kable(
  print_table[, -1],
  booktabs = T,
  col.names = c("", "Min.", "Mean", "Median", "Max"),
  align = c("c", rep("r", 4)),
  caption = c
) %>%
  pack_rows("2018/19", 1, 2) %>%
  pack_rows("2019/20", 3, 4) # %>% kable_classic()
# booktabs = TRUE, row.names = FALSE,
# col.names = cn, format = "markdown", caption = c
# )
rm(c, print_table)
```

```{r common-comb, include=T}
d <- SUMMARY_blandAltmann %>%
  filter(n >= 30) %>%
  select(c_short_od:med_estimate)

c <- paste0("Most used combination for both survey years together with at least 30 participants. Total and Percent correspond to participants. Mean and Median Expenses from the survey and in comaprison from the estimate in Euro. Drone brood removal method is exluded.")

cn <- c("Method", "Total [n]", "Percent [%]", "Mean", "Median", "Mean", "Median")

kable(
  d,
  booktabs = TRUE, row.names = FALSE,
  digits = 2,
  col.names = cn,
  caption = c,
) %>%
  add_header_above(c(" " = 3, "Survey" = 2, "Estimate" = 2)) %>%
  footnote(threeparttable = T, general = "SP/SU/WI = Spring/Summer/Winter, AS-LT/ST = Formic acid - long/short term; Ox-sub/pure/mix = Oxalic acid - sublimation, pure or mixture; Biot = Another biotechnical methods") # %>% kable_classic()
rm(c, cn, d)
```

Most of our estimates for common treatment with now at least 10 participants using the combination of methods are overestimated. This can be seen if we plot the mean differences, of survey expenses versus estimated expenses as statistical method of agreement [@bland1986]. $\log_2$ converted to minimizes effect of outliers, see figure \@ref(fig:estimates-bland).

The $\log_2$ change can be seen as follows, 1 represent a double of the original and -1 is half of the original on the transformed scale. The highest difference, which means the treatment estimates higher than the survey results are for combinations with formic acid shortterm. Which means the survey responses are ~1.7 times higher than the predicted estimates. Overall there are more overestimates of calculated expeneses and the results coming from the survey are lower. The two combinations with the higher overestimating are both including a biotechnical variant in summer. All estimates are inside of two standard deviations with set confidence interval of 95%.

(ref:estimated-bland) $\log_2$ transformed mean difference between survey and estimated expenses of the treatment combinations with at least 10 beekeepers using it. Lines indicating mean and lower and upper two times standard deviations each with 95% confidence interval. Highest and lowest two treatment combinations are marked.

```{r estimates-bland, include=T, fig.cap="(ref:estimated-bland)"}
knitr::include_graphics("images/bland-altman.png")
```

## Operation Size

Operation sizes and number of participants in our survey are not normally distributed. Most participants have 1-20 colonies in both survey years \@ref(tab:table-operationSummary). The distribution of the quartiles in our given Operation Size Groups are similar in both years, except for the operation size greater than 50 colonies in survey year 2019/20 is a visible difference \@ref(fig:qq-operation-size).

```{r table-operationSummary, include=T}
c <- "Operation Size (Numer of Colonies) distribution of the two survey years."

colNames <- c("Operation Sizes", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")

kable(
  STATS_operation_size$Summary[, -2],
  booktabs = T,
  col.names = colNames,
  digits = 2,
  align = c("c", rep("r", 4)),
  caption = c
) %>%
  pack_rows("2018/19", 1, 3) %>%
  pack_rows("2019/20", 4, 6) # %>% kable_classic()
```

```{r qq-operation-size, include=T, fig.cap="QQ-plots of our given operation size samples for both survey years. Shown fitted Q-Q Line to 25 and 75 Percentile. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible."}
knitr::include_graphics("images/qq-operation-size.png")
```

The given operation size groups shows significant difference in both years. The computed effect size for Kruskal-Wallis is small, with an estimate for the effect size in the survey year 2018/19 of $\eta^2(H)=$ `r round(STATS_operation_size[["Effect"]][["18/19"]],4)` and for 2019/20 of $\eta^2(H)=$ `r round(STATS_operation_size[["Effect"]][["19/20"]],4)`. Post-hoc analysis results in significant difference between the smallest operation size group with 1-20 colonies and the bigger operation groups. Between the operation size group with 21-50 and above 50 colonies was no statistically significant difference \@ref(fig:stats-operation-size).

```{r stats-operation-size, include=T, fig.cap="Boxplot of expenses in given operation size groups, with approximative Kruskal-Wallis test results and effect size. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-operation-size.png")
```

### Effect of treatment method removed - Big Operations Treatment Methods

Treatment Methods not used by big operations: `r  STATS_operation_size$treatments`

```{r stats-operation-size-bigop, include=T, fig.cap="Subset with only treatment methods which are used by Operations > 50, with approximative Kruskal-Wallis test results and effect size. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-operation-size-treatment.png")
```


### Extimated Extrapolated Costs

(ref:stats-operation-size-extrapolated) Extrapolated costs based on mean with bootstrap 95% CI as error lines. Total colonies from \@ref(tab:registered) table, operation size distribution as represented in our survey.

```{r stats-operation-size-extrapolated, include=T, fig.cap='(ref:stats-operation-size-extrapolated)'}
knitr::include_graphics("images/stats-operation-size-extrapolated.png")
```

year 18/19 = `r format(round(SUMMARY_extrapolatedSum$total), big.mark = ",")[1]`

year 19/20 = `r format(round(SUMMARY_extrapolatedSum$total), big.mark = ",")[2]`

## Certified Organic Bekeeper

Operation sizes and number of participants in our survey are not normally distributed. Most participants have 1-20 colonies in both survey years \@ref(tab:table-certOrgSummary). The distribution of the quartiles in our given Operation Size Groups are similar in both years, except for the operation size greater than 50 colonies in survey year 2019/20 is a visible difference \@ref(fig:qq-operation-size).

```{r table-certOrgSummary, include=T}
c <- "Certified Organic Beekeeper distribution of the two survey years."

colNames <- c("Certified Organic", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")

kable(
  STATS_certorg$Summary[, -2],
  booktabs = T,
  col.names = colNames,
  digits = 2,
  align = c("c", rep("r", 4)),
  caption = c
) %>%
  pack_rows("2018/19", 1, 4) %>%
  pack_rows("2019/20", 5, 7) # %>% kable_classic()
```

```{r qq-cert-org, include=T, fig.cap="QQ-plots of our given operation size samples for both survey years. Shown fitted Q-Q Line to 25 and 75 Percentile. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible."}
knitr::include_graphics("images/qq-cert-org.png")
```

The statistical significant difference between organic and non-organic beekeepers in both years. The computed effect size is very small, with size in the survey year 2018/19 of $\eta^2(H)=$ `r round(STATS_certorg[["Effect"]][["18/19"]],4)` and for 2019/20 of $\eta^2(H)=$ `r round(STATS_certorg[["Effect"]][["19/20"]],4)`, figure \@ref(fig:stats-cert-org). 


```{r stats-cert-org, include=T, fig.cap="Boxplot of expenses in given operation size groups, with approximative Kruskal-Wallis test results and effect size. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-cert-org.png")
```

### Effect of treatment method removed - Only Cert Org Treatment Methods

Number of Treatment Methods used by certified organic beekeeper: `r  length( STATS_certorg$treatments)`

The computed effect size for Kruskal-Wallis is very small, with an estimate for the effect size in the survey year 2018/19 of $\eta^2(H)=$ `r round(STATS_certorg[["Effect_Treatment"]][["18/19"]],4)` and for 2019/20 of $\eta^2(H)=$ `r round(STATS_certorg[["Effect_Treatment"]][["19/20"]],4)`

```{r stats-cert-org-treatment, include=T, fig.cap="Subset of expenses in given operation size groups, with approximative Kruskal-Wallis test results and effect size. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-cert-org-treatment.png")
```

## Migratory Bekeeper

Operation sizes and number of participants in our survey are not normally distributed. Most participants have 1-20 colonies in both survey years \@ref(tab:table-certOrgSummary). The distribution of the quartiles in our given Operation Size Groups are similar in both years, except for the operation size greater than 50 colonies in survey year 2019/20 is a visible difference \@ref(fig:qq-operation-size).

```{r table-migratorySummary, include=T}
c <- "Migratory Beekeeper distribution of the two survey years."

colNames <- c("Migratory", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")

kable(
  STATS_migratory$Summary[, -2],
  booktabs = T,
  col.names = colNames,
  digits = 2,
  align = c("c", rep("r", 4)),
  caption = c
) %>%
  pack_rows("2018/19", 1, 3) %>%
  pack_rows("2019/20", 4, 6) # %>% kable_classic()
```

```{r qq-migratory, include=T, fig.cap="QQ-plots of our given operation size samples for both survey years. Shown fitted Q-Q Line to 25 and 75 Percentile. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible."}
knitr::include_graphics("images/qq-migratory.png")
```

The computed effect size for Kruskal-Wallis is very small, with an estimate for the effect size in the survey year 2018/19 of $\eta^2(H)=$ `r round(STATS_migratory[["Effect"]][["18/19"]],4)` and for 2019/20 of $\eta^2(H)=$ `r round(STATS_migratory[["Effect"]][["19/20"]],4)`


```{r stats-migratory, include=T, fig.cap="Boxplot of expenses in given operation size groups, with approximative Kruskal-Wallis test results and effect size. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-migratory.png")
```

### Effect of treatment method removed - Only Migratory Treatment Methods

Number of Treatment Methods used by certified organic beekeeper: `r  length( STATS_migratory$treatments)`

The computed effect size for Kruskal-Wallis is very small, with an estimate for the effect size in the survey year 2018/19 of $\eta^2(H)=$ `r round(STATS_migratory[["Effect_Treatment"]][["18/19"]],4)` and for 2019/20 of $\eta^2(H)=$ `r round(STATS_migratory[["Effect_Treatment"]][["19/20"]],4)`


```{r stats-migratory-treatment, include=T, fig.cap="Subset only migratory beekeeper treatment methods of expenses in given operation size groups, with approximative Kruskal-Wallis test results and effect size. One extreme outlier (>100) for survey 19/20 in group 1-20 is not visible. Black points indicating mean. Pairwise comparison of median between groups are given."}
knitr::include_graphics("images/stats-migratory-treatment.png")
```

## Treatment Methods
### Cost Loss Plot

(ref:stats-loss-cost-plot) Loss rate GLM 95% CI, median Price, Other < 10n methods.

```{r stats-loss-cost-plot, include=T, fig.cap='(ref:stats-loss-cost-plot)'}
knitr::include_graphics("images/stats-loss-cost-plot.png")
```
