# Results

## Survey Data

```{r, include=FALSE}
RAW_REPORTS <- RAW %>% group_by(year) %>% 
  summarize(
    n = n(),
    mean_colonies   = round(mean(hives_winter),2),
    median_colonies = median(hives_winter)
  )

DATA_REPORTS <- DATA %>% group_by(year) %>% 
  summarize(
    n = n(),
    colonies = sum(hives_winter),
    mean_colonies   = round(mean(hives_winter),2),
    median_colonies = median(hives_winter)
  )

REPORTS <- tibble(
  Year    = RAW_REPORTS$year,
  Total   = RAW_REPORTS$n,
  Cost    = DATA_REPORTS$n,
  Percent = round(DATA_REPORTS$n/RAW_REPORTS$n*100,1)
)

NO_COST <- RAW %>% filter(is.na(costs)) %>% group_by(year) %>% summarise(n = n())

stats_aut = stats_aut %>% add_column(
  survey_beekeeper = DATA_REPORTS$n,
  survey_colonies = DATA_REPORTS$colonies
) %>% mutate(
  rate_beekeeper = round(survey_beekeeper / beekeeper * 100, 1),
  rate_colonies = round(survey_colonies / colonies * 100, 1)
)

rm(DATA_REPORTS, RAW_REPORTS)
```

The number of reports which did include expenses and removed invalid or illogical answers. The cost answer was left empty by `r NO_COST$n[NO_COST$year == '18/19']` participants in 2018/19 survey and `r NO_COST$n[NO_COST$year == '19/20']` participants in 2019/20. The number of naswers was similar for the survey of 2018/19 with `r REPORTS$Percent[1]`% and for 2019/20 with `r REPORTS$Percent[2]`, see table \@ref(tab:reports). Compared to the number of registered beekeeper and honey bee colonies with the national beekeeping association "Biene Österreich", the number of participation with valid answers including costs for survey year 2018/19 with `r stats_aut$rate_beekeeper[stats_aut$year == '2018']`% and for the survey year 2019/20 with `r stats_aut$rate_beekeeper[stats_aut$year == '2019']`%, see table \@ref(tab:registered). The distribution map of participants with valid answers shows good coverage all over Austria (figure \@ref(fig:distr-map)). 

```{r reports, include=T}
cn = c("Year", "Total [n]", "Answered [n]", "Percent [%]")
c = "Number of participants answering the question for estimated treatment expenses per colony and total number of survey participants."
knitr::kable(
  REPORTS,
  booktabs = TRUE, row.names = FALSE,
  col.names = cn, format = "markdown", caption = c
)
rm(REPORTS, cn, NO_COST)
```

```{r registered, include=T}
cn = c("Year", "Beekeeper [n]", "Colonies [n]", "Survey Beekeeper [n]", "Survey Colonies [n]")
c = "Percentage of survey participants in relation to the amount of registered beekeepers with the national beekeeping association Biene Österreich (2018 and 2019)."
knitr::kable(
  stats_aut[,c(2:6)],
  booktabs = TRUE, row.names = FALSE,
  col.names = cn, format = "markdown", caption = c
)
rm(c, cn)
```

```{r r-map, warning=F, echo=F, include=F}
source("partials/r-map.R", local = knitr::knit_global())
```

```{r distr-map, include=T, fig.cap="Distribution map of approximnate main winter apiary position for our survey participants in the survey year 2018/19 and 2019/20. Shapefiles under Creative Commons https://www.data.gv.at/"}
p
rm(p, MAP1819, MAP1920, MAP_POINTS, MF_DISTRICTS, MF_STATES)
```

```{r}
# Expenses Data 
expenses_table <- DATA %>% 
  group_by(year) %>% 
  summarise(
    min    = format(round(min(t_estimated),2), nsmall = 2),
    mean   = format(round(mean(costs),2), nsmall = 2),
    median = format(round(median(costs),2), nsmall = 2),
    max    = format(round(max(costs),2), nsmall = 2)
    ) %>%  add_column(type = "Survey", .after="year")
estimate_table <- DATA %>% 
  group_by(year) %>% 
  summarise(
    min    = format(round(min(t_estimated),2), nsmall = 2),
    mean   = format(round(mean(t_estimated),2), nsmall = 2),
    median = format(round(median(t_estimated),2), nsmall = 2),
    max    = format(round(max(t_estimated),2), nsmall = 2)
    ) %>% add_column(type = "Estimated", .after="year")
```


The distribution of expenses per colony is right skewed with some extreme high outliers, but mean and median are for each year close (figure \@ref(fig:distr-year)). Especially the survey year 2019/20 has one extreme value at `r expenses_table$max[expenses_table$year == "19/20"]` Euro. The two survey years compared are similar in the results with mean difference `r format(as.numeric(expenses_table$mean[1])-as.numeric(expenses_table$mean[2]), nsmall=2)` Euro and median difference `r format(as.numeric(expenses_table$median[1]) - as.numeric(expenses_table$median[2]), nsmall=2)` Euro. The distribution shows that participants preferable answer in round estimates eg. 5.00, 10.00, 15.00 Euros.


```{r distr-year, include=T, messages=F, warnings=F, fig.cap="Violin and overlapping boxplot of the costs from the survey, extreme outliers are not visible."}
text <- paste0(
  "Max.: ", expenses_table$max, "\n",
  "Min.: ", expenses_table$min, "\n",
  "Mean: ", expenses_table$mean, "\n",
  "Median: ", expenses_table$median, "\n"
  )

ggplot(DATA) +
  geom_violin(
    aes(x = year, y = costs), 
    fill=colorBlindBlack8[7],
    color=colorBlindBlack8[7]
    ) +
  geom_boxplot(
    aes(x = year, y = costs), 
    outlier.shape = NA, alpha=0.5, fill=colorBlindBlack8[5]
    ) +
  geom_segment(
    x = 1, y = 45,
    xend = 1, yend = 52,
    lineend = "round",
    linejoin = "round",
    size = 0.5, 
    arrow = arrow(length = unit(0.1, "inches"))
  ) + 
  xlab("Survey Year") + ylab("Expenses / Colony [Euro]") +
  geom_segment(
    x = 2, y = 45,
    xend = 2, yend = 52,
    lineend = "round",
    linejoin = "round",
    size = 0.5, 
    arrow = arrow(length = unit(0.1, "inches"))
  ) + 
  annotate(
    "text",
    label = text,
    x = c(1.35, 2.35), y = c(40, 40),
    hjust = "right"
  ) + 
  theme_classic() +
  scale_y_continuous(
    limits = c(0,50),
    breaks = c(seq(0,50,5))
      )

```

## Expenses Estimations {#r-estimations}

The calculated estimated expenses mean and median are higher than in the survey given by participants, but more similar when compared the two survey years, see table \@ref(tab:table-estimates). The most common combinations, without drone brood removal, for both survey years together and the corresponding estimates can be seen in table \@ref(tab:common-comb). For the tables the estimated expenses are calculated for each beekeeper in the survey and then the average was taken as with the survey expenses.

```{r table-estimates, include=T}
c = "Comparison of estimated expenses and the expenses given by participants in the survey. All values are in Euro."

print_table <- rbind(estimate_table, expenses_table) %>% 
   arrange(c(1,3,2,4))

kable(
  print_table[,-1], booktabs = T,
  col.names = c("", "Min.", "Mean", "Median", "Max"),
  align = c("c", rep("r", 4)),
  caption = c
  ) %>% 
  pack_rows("2018/19", 1, 2) %>%
  pack_rows("2019/20", 3, 4) # %>% kable_classic()
  #booktabs = TRUE, row.names = FALSE,
  #col.names = cn, format = "markdown", caption = c
#)
#rm(REPORTS, cn, NO_COST)
```

```{r common-comb, include=T}
d <- DATA %>% 
  group_by(t_short_od) %>% summarise(
    n     = n(),
    p     = round(n()*100/nrow(DATA),2),
    mc    = round(mean(costs), 2),
    medc  = round(median(costs), 2),
    me    = round(mean(t_estimated), 2),
    mede  = round(median(t_estimated), 2),
  ) %>% 
  filter(n >= 30) %>% arrange(desc(n))

c <- paste0("Most used combination for both survey years together with at least 30 participants. Total and Percent correspond to participants. Mean and Median Expenses from the survey and in comaprison from the estimate in Euro. Drone brood removal method is exluded.")

cn = c("Method", "Total [n]", "Percent [%]", "Mean", "Median", "Mean", "Median")

kable(
  d,
  booktabs = TRUE, row.names = FALSE,
  digits = 2,
  col.names = cn,
  caption = c,
) %>% 
  add_header_above(c(" " = 3, "Survey" = 2, "Estimate" = 2)) %>% 
  footnote(general = "AS-LT/ST = Formic acid - long/short term; Ox-sub/pure/mix = Oxalic acid - sublimation, pure or mixture; Biot = Another biotechnical methods") # %>% kable_classic()
rm(c, d)
```

```{r}
# Bland-Altmann
d <- DATA %>% 
  group_by(t_short_od) %>% summarise(
    n    = n(),
    p    = round(n()*100/nrow(DATA),2),
    mc   = round(mean(costs), 2),
    medc = round(median(costs), 2),
    me   = round(mean(t_estimated), 2),
    mede = round(median(t_estimated), 2),
  ) %>% 
  mutate(
    dif = mc-me
  ) %>% 
  filter(n >= 15) %>% arrange(desc(n))

ba.stats <- bland.altman.stats(d$mc, d$me)
ba.stats$label <- d$t_short_od

limit_y = round( ifelse( max(ba.stats$diffs) > (-1*min(ba.stats$diffs)), max(ba.stats$diffs), -1*min(ba.stats$diffs) ) + 0.5, digits = 1)
```

Most of our estimates for common treatment with now at least 15 participants using the combination of methods are overestimated. This can be seen if we plot the mean differences of survey expenses versus estimated expenses, see figure \@ref(fig:estimates-bland). Only one treatment combination (Oxalic acid mixture and Thymol) is outside of the line of two standard deviations, but inside our set confidence interval of 95%. For this combination we overestimated the expenses by a mean difference of 10.10 Euros.

```{r estimates-bland, include=T, fig.cap="Bland-Altmann Plot, mean difference between survey and estimated expenses of the treatment combinations with at least 15 beekeepers using it. Lines indicating mean and lower and upper two times standard deviations each with 95% confidence interval."}
ggplot() +
  aes(x = ba.stats$means, y = ba.stats$diffs) +
  geom_point(aes(size = d$n)) +
  geom_label(
    aes(
      x = ba.stats$means[abs(ba.stats$diffs)>8], 
      y = ba.stats$diffs[abs(ba.stats$diffs)>8], 
      label = ba.stats$label[abs(ba.stats$diffs)>8]
      ),
    nudge_x = -2
    )+
  geom_abline(
    aes(
      intercept = ba.stats$lines, 
      colour = I(c(colorBlindBlack8[3], colorBlindBlack8[2], colorBlindBlack8[3])), 
      slope = c(rep(0, 3))),
    show.legend = F
    ) +
  geom_abline(
    aes(
      intercept = ba.stats$CI.lines, 
      color = I(c(rep(colorBlindBlack8[3], 2), rep(colorBlindBlack8[2], 2), rep(colorBlindBlack8[3], 2))),
      slope = c(rep(0, 6))
      ),
    linetype = "dashed",
    alpha = 0.5,
    show.legend = F
  ) +
  geom_hline(yintercept = 0, linetype = "dotted") +

  xlab("Means [Euro]") + ylab("Differences [Euro]") +
  labs(size = "Answers [n]") + 
  ylim(c( -1*limit_y, limit_y )) +
  theme_classic()

rm(d, ba.stats, limit_y)
```

## Operation Size

```{r r-operation-size, warning=F, echo=F, include=F}
source("partials/r-operation-size.R", local = knitr::knit_global())
```

Operation sizes and number of participants in our survey are not normally distributed. Most participants have 1-20 colonies in both survey years \@ref(tab:table-operationSummary). The distribution of the quartiles in our given Operation Size Groups are similar in both years, except for the operation size greater than 50 colonies in survey year 2019/20 is a visible difference \@ref(fig:qq-operation-size).

```{r table-operationSummary, include=T}
c = "Operation Size (Numer of Colonies) distribution of the two survey years."

colNames <- c("Operation Sizes", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")

kable(
  summaryOperation[,-2], booktabs = T,
  col.names = colNames,
  digits = 2,
  align = c("c", rep("r", 4)),
  caption = c
  ) %>% 
  pack_rows("2018/19", 1, 3) %>%
  pack_rows("2019/20", 4, 6) # %>% kable_classic()
```

```{r qq-operation-size, include=T, fig.cap="QQ-plots of our given operation size samples for both survey years. Shown fitted Q-Q Line to 25 and 75 Percentile."}
plotOperationQQ
```

The given operation size groups shows significant difference in both years. The computed effect size for Kruskal-Wallis is small, with an estimate for the effect size in the survey year 2018/19 of $\eta^2(H)=$ `r round(resEffect$effsize[1],4)` and for 2019/20 of $\eta^2(H)=$ `r round(resEffect$effsize[2],4)`. Post-hoc analysis results in significant difference between the smallest operation size group with 1-20 colonies and the bigger operation groups. Between the operation size group with 21-50 and above 50 colonies was no statistically significant difference \@ref(fig:stats-operation-size).

```{r stats-operation-size, include=T, fig.cap="Distribution of expenses in given operation size groups. Kruskal-Wallis and Post-Hoc analysis with Dunn-test are annoated. The symbols **** indiciating highly significant result and ns not significant."}
plotOperationStat
```

