---
documentclass: scrreprt
header-includes:
- \usepackage{hyperref}
- \usepackage{float}
- \usepackage{siunitx}
- \usepackage{threeparttable}
- \usepackage{multirow}
- \usepackage{pdflscape}
- \usepackage{colortbl}
bibliography: bib-refs.bib
biblatexoptions: [
    backend=biber,
    style=authoryear,
	natbib=true,				
	hyperref=true,			
	backref=false,		
	isbn=false,						
	url=false,					
	doi=false,
    date=year,			
	urldate=long,
	maxbibnames=99,
	maxcitenames=2,
	uniquelist=false
    ]
link-citations: yes
---
```{r, warning=F, echo=F, include=F}
# special case for PDF and table as they otherwise wont work
if (knitr::is_latex_output()) {
    options(knitr.table.format = "latex")
} else {
    options(knitr.table.format = "html")
}
knitr::opts_chunk$set(fig.pos = "htp", out.extra = "")
```

<!--chapter:end:index.Rmd-->

# Introduction

The economic and ecology value, the importance of feeding mankind by pollinating crops by wild bees and honey bees cannot be denied [@kearns1998;@klein2007;@gallai2009]. Furthermore managed honey bee colonies improve the quality and amount of harvest for various crops, as example oilseed rape, sunflowers and brassica vegetables [@krause1981;@sushil2013]. There may be a lot more benefits which are often overlooked, for example the bee colonies fertilizing effect of bee frass in foraging areas, which at least under study control did show a significant release of inorganic nitrogen into the soil [@mishra2013]. A market analysis from England showed the economic value of pollination, honey, and beeswax estimated by £800 per colony in the year 1992 [@carreck1998]. Even though we already know and even learn each day more about importance of insect in our ecosystem an alarming decline of wild pollinators can be seen over the last years [@hallmann2017;@sanchez-bayo2019]. The reasons for the decline seem manifold: parasites; pathogens; environmental pollution; rapid climate change, loss of insect friendly habitats etc. [@biesmeijer2006;@potts2010;@goulson2015;@woodcock2017].

With the economic and ecology value of honey bees in mind I want to look at the expenses and treatment efficiency of varroa mite control methods in Austria. The varroa mite, *Varroa destructor*, is worldwide, with some exceptions, an active threat to apiculture [@dahle2010;@morawetz2019;@rosenkranz2010;@genersch2010;@noel2020;@roth2020]. In Austria the beekeepers have to cope with this imported aggressor since (REFERENZ) and need to treat their colonies to prevent unacceptable financial losses, as most untreated colonies would die off within 2-3 years [@rosenkranz2010]. The control of the mite in Austria is mainly done with organic acids (eg. formic acid, oxalic acid), essential oils (thymol), synthetic acrazides or biotechnical methods [@oberreiter2020]. Each of these treatment methods has it advantages and or disadvantages and most of the time beekeeper use a combination of them [@rosenkranz2010]. Though, the treatment alone does not guaranteed the survival of colonies, studies show that the education, experience and correct application and timing of treatment plays an important role [@jacques2017;@morawetz2019;@brodschneider2013;@vanderzee2014].

In the foreground of this work is an exploratory analysis of a citizen science survey data from the years 2018/19, 2019/20 and 2020/21. The survey is carried out since 2008 by the Institute of Biology at the University of Graz to collect data on winter losses of bee colonies [@brodschneider2013]. In the past three years the participants could also answers an optional question about their expenses of treatment per bee colony, without labor costs. This question is the main focus of this study, as such a descriptive analysis of treatment expenses has never been carried out in Austria in this form before. In addition the treatment methods and their efficiency are compared to the direct costs to give possible valuable input for beekeepers for their decision making on which methods are a good option for their operation. Since different methods are not always equally successful in treatment previous carried out studies from the same citizen science survey [@brodschneider2013;@crailsheim2018;@oberreiter2020] and probably also cause different expenses, the expenditure per colony could mean a direct correlation with the winter colony losses for the beekeeper. Additionally higher losses mean additional costs for the beekeeping business.

<!--chapter:end:01-intro.Rmd-->

# Material and Methods

```{r load-files, warning=F, echo=F, include=F}
source("src/setup.R", local = knitr::knit_global())
source("src/mm-cleanup.R", local = knitr::knit_global())
```

```{r, include=FALSE}
if (file.exists("output/r-model.rds")) {
  r_model <- readRDS("output/r-model.rds")
} else {
  source("src/r-model.R", local = knitr::knit_global())
}
```


## Survey

The survey is a citizen science survey which is done each year in spring since 2008. It is a combination of online, beekeeping journal and paper submission. The main focus and question of the survey is the yearly colony losses over winter for the Austrian beekeepers'. The survey is part of the COLOSS questionnaire and most questions are in accordance with other participating countries [@vanderzee2013]. The questions are simple and relate to possible risk factors which may influence overwintering success as seen in previous studies in Austria [@oberreiter2020;@brodschneider2010a]. The survey is only obligatory for beekeepers who want to participate in the Austrian bee health programme. The confirmation of participation is one of the options which allows a beekeeper to apply and/or get a higher rate of government aid for investments in technical equipment to improve production quality and hygiene in their beekeeping operation.^[AgrarMarkt Austria, 06/2021 - Version 04]

As most questions are related to winter colony losses I am only interested in an subset of questions for my research question: number of colonies wintered (size of operation), number of colonies lost over the winter period (due natural or queen loss, without losses due to natural disaster), state and district of main wintering apiary (as possible covariate), month(s) and type of treatment used. In addition two operational questions are also explored, if the beekeeper migrates with his colonies and if he/she is an organic certified beekeeper, with the possible answers 'Yes', 'No' and 'Unsure'. The answers of these questions are explored in combination with the answer on the question about estimated treatment expenses per colony without labor costs. Participants could answer this questions with any positive number from zero and without any upper limit. The treatment expenses questions was only available in the Austrian COLOSS questionnaire and only in the online survey as the questionnaire which are printed in the beekeeping journal and handed out paper submissions are shorter versions.

To further understand why participants choose their varroa control method, the last survey year (winter 2020/21) did also include the question: 'Which main motivations are most likely to apply to you when choosing the Varroa control method (max. 5)?'. The possible answers, which were arbitrary defined, were displayed in a randomized order and included: 'Habit', 'Economic costs', 'Marketing', 'Subsidies', 'Prescription', 'Philosophy', 'Efficacy', 'Method applicable with and without brood', 'Time of season where they can be applied', 'Colony strength', 'Colony infestation level (Varroa)', 'Environmental conditions', 'Recommendations from beekeeping associations, extension workers, veterinarians, magazines, etc.', 'Legal status (regulatory framework)', 'Availability of products', 'Resistances', 'Residues',  'Side effects on bees', 'Level of difficulty and needed  equipment', 'Time and number of applications', 'Other'. This question as only available in the online survey. A total of `r length(mmList$motivation$no_answer)` participants did choose not to answer this question or did by accident choose more than five answers, which leaves `r mmList$motivation$valid_answers` valid answers to this new question.

The survey was anonymous and private data like IP addresses were only used in the first step to help identify possible double entries. In order to protect the personal data of the participants, a privacy statement was drawn up between the main persons involved in the evaluation. If voluntary contact details was given, it was only used for enquiries to correct missing or incorrect data. All personal data was anonymised prior analysis. 

As I analysed three continuous survey years and the survey is anonymous I have no assumption if the same beekeepers participated in more than one survey. Only for the handful of beekeepers who did always give the same contact details. Therefore, I can not say that the years are independent or not and analysed them separately. The advantages to compare multiple years is, that I may have a better overview if the survey is representative, as there should not be much change in the expenses and distribution of beekeepers apiary location and size of operations over the survey years. Furthermore, overall winter loss rates fluctuate between years of survey. This means I can check if a given treatment method did result in all survey years in low or high winter mortality or not.

## Expenses Estimation

Expenses estimation was carried out to check if there are discrepancies between participants answers and estimate. To calculate the estimates I researched online store prices in 2020 in Austria for official registered medication[^mm-1] and used common application amount from beekeeping school materials and manufacturer instructions (Tab. \@ref(tab:standard-cost)). An example calculation, based on equation (\@ref(eq:estimate-calculation)), with the given estimates, with average month of usage and an estimated of 10 colonies  can be seen in Table \@ref(tab:common). 

```{=tex}
\begin{equation}
\begin{aligned}
  \text{estimate/colony} = (\text{investment} / \text{total colonies}) + \text{material} + \text{consumable} * \text{months}
\end{aligned}
(\#eq:estimate-calculation)
\end{equation}
```

With this method an estimate was calculated for each survey participants with the given answer for treatment method (or combination), number of colonies and number of months used.

[^mm-1]: Austrian medicinal product index: <https://aspregister.basg.gv.at/>, accessed November 2020

```{r standard-cost, include=T}
c <- "The calculated estimates for treatment expenses per method. Investments can be used long term (we calculate 10 years, eg. hyperthermia equipment) and are divided by the number of colonies. Material can also be used long term (7 years, eg. queen cages) but needs to be bought for each colony. Consumables are used for each colony (eg. formic acid long term was calculated with 200ml use of formic acid)."
cn <- c("Methode", "Investment", "Material", "Consumables")
tab <- kbl(
  treatmentList[-1, c(3, 5:7)],
  booktabs = TRUE,
  row.names = FALSE,
  # format = "markdown",
  caption = c,
  col.names = cn,
  linesep = c("", "", "\\addlinespace"),
) %>%
  footnote(threeparttable = T, general = "Synthetic methods are combined and include Amitraz, Coumaphos, and other synthetic methods; Other biotechnical methods do not include drone brood removal or hypothermia; Another method excludes synthetic methods.") %>%
  kable_styling(font_size = 7)
tab
rm(c, cn)
```

```{r common, include=T}
# colonies based for estimate
m_colonies <- 10
col <- dfData %>%
  select(!!(paste0(treatmentList$ttotal, "12")))
# Get number of participates using the single treatment methods
sin <- col %>%
  mutate(across(.cols = everything(), as.logical)) %>%
  colSums()
# get the average amount for number of months
nu <- col %>%
  na_if(0) %>%
  colMeans(na.rm = T)

common_single <- tibble(
  tname = treatmentList$tname,
  n = sin,
  p = round(sin * 100 / nrow(dfData), 2),
  nu = round(nu, 2),
  est = round(treatmentList$investment / m_colonies + treatmentList$material + treatmentList$consumables * nu, 2)
) %>% arrange(desc(p))

c <- paste0("Treatment methods ordered by usage over the survey years, months indicating the average of months the corresponding method was used. Estimated costs per colony are calculated with ", m_colonies, " colonies, which represents the median number of colonies in the survey, and the average months of usage.")

cn <- c("Method", "Total [n]", "Percent [%]", "Average Months [n]", "Estimated Costs")
kable(
  common_single[-1, ],
  booktabs   = TRUE,
  row.names = FALSE,
  col.names  = cn,
  # format = "markdown",
  caption    = c,
  linesep = c("", "", "\\addlinespace"),
) %>%
  kable_styling(font_size = 7)

rm(cn, c, common_single, nu, sin, col, m_colonies)
```

## Data Cleanup

### Newspaper and Paper Submission

The short version of the survey, which was printed in a beekeeping journal and paper handout submissions, did not include the question about expenses and, therefore, were excluded. That concern a total of `r sum(mmList$submitted_all %>% filter(submitted != "Internet") %>% pull(n))` submission from `r sum(mmList$submitted_all$n)` over the three years of survey. Though there is one exception which was kept to this, as one person did send a filled out paper handout of the online survey.

### No Answers on Expenses

Not all participants did answers the question on expenses even when they had the possibility to do so. These participates were also excluded as this question is the main focus of the study. In numbers these are in 2018/19 a total of `r mmList$internet_no_answer %>% filter(year == "18/19") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "18/19") %>% pull(np)`%), 2019/20 a total of `r mmList$internet_no_answer %>% filter(year == "19/20") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "19/20") %>% pull(np)`%) and in the last survey year 2020/21 a total of `r mmList$internet_no_answer %>% filter(year == "20/21") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "20/21") %>% pull(np)`%) answers.

### No Treatment

Only `r nrow(mmList$no_treatment %>% filter(costs == 0))` participants did no treatment against the varroa mite and answered with zero expenses. In addition `r nrow(mmList$no_treatment %>% filter(costs > 0))` participants answered that they did no treatment but have included expenses for varroa treatment. This illogical entries and the participants with zero costs and the before mentioned no treatment answers were removed from the data analysis. 

### No Methods

In total `r nrow(mmList$no_method)` participants did answer varroa expenses (min. `r min(mmList$no_method$costs)`, max. `r max(mmList$no_method$costs)` Euro per colony) and said they treated against varroa but did not specify their treatment method. I decided to remove them from the dataset, as it was only a small number and I could not further validate the expenses answers or use it for the statistics which involved the treatment methods.

### Zero Expenses

In total `r nrow(mmList$cost_zero$data)` participants said their treatment expenses were zero. Only one answer were kept, as the treatment was a combination of hyperthermia and biotechnical and I can make no assumption about the real expenses of the participant. Ofcourse the equipment for the hyperthermia do cost something, but I do not know more details, as he could already have the equipment for a long time. A total of `r length(mmList$cost_zero$id_remove)-length(mmList$cost_zero$id_sponsor)` were removed as they said zero expenses but actually did treatment with organic acids, which is illogical as the organic acids are consumed and not for free. Additionally `r length(mmList$cost_zero$id_sponsor)` participants got a sponsorship (beekeeping club or local community) for their treatment expenses and had therefore zero expenses, which were also removed.

### Outlier detection and imputation

To detect outliers in the dataset two methods were used. For the upper limit I decided to filter the dataset based on the arbitrary decision if the expenses per colony is equal or more than double of the whole dataset extreme outlier (`r mmList$cost_upper$upper_limit` Euro), as defined in equation (\@ref(eq:extreme-outliers)).

```{=tex}
\begin{equation}
\begin{aligned}
  x >= (Q3 + 3 * IQR) * 2
\end{aligned}
(\#eq:extreme-outliers)
\end{equation}
```

This did detect `r nrow(mmList$cost_upper$data)` anomaly values based on the upper limit and without any information of the given treatment method. The second one is model based with the isolation forest approach [@liu2008], implemented in the R package [@isotree2021]. Input for the model was the expenses per colony and a dummy column which was encoded for each treatment method combination without drone brood removal. The parameters were set to take all rows of our dataset, 100 binary trees and split on a single variable. I defined values above 0.6 in the resulting standardized outlier score, as described in @liu2008, as anomaly values, which resulted in a list of `r nrow(mmList$cost_upper$forest)`. The two approaches did mostly overlap in their results and the lists were combined, which resulted in `r nrow(mmList$cost_upper$combined_list)` possible outliers. Further investigating of the outlier answers revealed that most of them did answer total expenses per operation and not expenses per colony as asked in the survey. As this is only an assumption, I removed from the outliers list participants which used Hyperthermia as treatment method, which could involve big investment, especially if it was only used for one year. This was also stated by some beekeepers as comments in the survey. As for the rest of the extreme outliers (*n* = `r nrow(mmList$cost_upper$new_data)`), I divided for each answers the expenses by the reported number of colonies going into winter. This means the manipulative impact was higher for participants which had high expenses above the limit and also reported a large number of colonies and less for small operations, were the high expenses are possible true. The new calculated costs were inspected to be plausible, eg. not too low, and were updated in the cleaned dataset for further analysis.

```{r isolation-forest, include=T, fig.cap="Isolation forest standardized outlier score to expenses per colony of the whole dataset. Black points are within the defined average range and pink coloured points indicating possible outliers. Red background area above the set average limit of >= 0.6 outlier score."}
include_custom("output/figs/isolation_forest.png")
```

### Final Data Count

After the afore mentioned data cleaning steps, which filtered survey responses with valid answers for expenses per colony, the number of answer was reduced by around 21-24% (Table \@ref(tab:reports)).

```{r reports, include=T}
cn <- c("Year", "Total [n]", "Valid Answers [n]", "Percent [%]")
c <- "Number of participants with valid answers on the question for estimated treatment expenses per colony and the total number of survey participants."
tab <- knitr::kable(
  mmList$reports %>%
    mutate(
      year = paste0("20", year)
    ),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  caption = c
) # %>%
# kable_styling(font_size = 7)
tab
rm(cn, c, tab)
```

## Statistics

The analysis of the data was carried out with R [@r2020], plotting and data manipulation was done mainly with the tidyverse package collection [@tidyverse2019]. The code, including a listing of the remaining packages not mentioned here, is available on GitHub under an MIT licence[^mm-2]. As the main goal of the study is an exploratory data analyses (EDA) I try to rely mostly on descriptive statistics and visualise the data behind it. The use of inference based statistics is only used for this explorative purpose and no focus on the *p*-value is given, but as it is still common the *p*-value will be reported. Inference based statistics should normally only be used for a predefined hypothesis and experimental design directly related to the research question. 

[^mm-2]: Github: <https://github.com/HannesOberreiter/treatment-expenses-austria>

### Single Factor Analysis

The operational factor question analysis (Migratory Beekeeper and Certified Organic Beekeeper) did include as possible answers 'Yes', 'No' and 'Uncertain'. The category 'Uncertain' and participants which did not answers the question were not used in the single factor statistical analysis (Table \@ref(tab:factor-removed)). The *p*-value is generated from the median difference between groups in comparison to the permutation generated null distribution (5,000 permutations). For the median point estimate a confidence interval (95%) was calculated based on 1,000 bootstrap resamples. The visual statistical test results of the the difference between groups is attached in the appendix section.

### Multiple Regression - Prediction

To evaluate if and how well the selected questions can be used for prediction of the treatment expenses a simple linear multiple regression model with treatment expenses per colony as dependent variable was fitted. The model creation and evaluation was done with the tidymodels package [@tidymodels2020]. Data preprocessing included normalization with $log_{10}$ transform of number of colonies wintered and expenses of treatment, whereas beforehand one single zero expenses answer was removed (Fig. \@ref(fig:model-qq)). Same as in the single factor analysis to simplify the model interpretation only participants which did answer "Yes" or "No" for the two operational factor questions were used in the model and dummy transformed to 0 (False) if the answer was no and 1 (True) if the answer was yes (Table \@ref(tab:factor-removed)).

(ref:model-qq) QQ-Plot of $\log_{10}$ transformed normalization of (A) treatment expenses per colony and (B) number of honeybee colonies wintered.
```{r model-qq, include=T, fig.cap="(ref:model-qq)"}
include_custom("output/figs/model-qq.png")
```

Treatment methods were binary transformed, if the participants did use it in any month to 1 (True) otherwise if not at all applied to 0 (False). Model fitting was done with 90% of the original dataset (n = `r nrow(r_model$train_data)`) and out of sample evaluation of accuracy was done with 10% (n = `r nrow(r_model$test_data)`. Best model selection was selected based on lowest AIC and BIC value.

```{r factor-removed, include=T}
# cn <- c("Question", "Year", "Participants [n]", "Answer")
cn <- c("Year", "Participants [n]", "Answer")
c <- "Number of participants which were removed in the single factor analysis and multiple regression model."
tab <- knitr::kable(
  mmList$single_factor_drop %>%
    mutate(
      year = paste0("20", year),
      year = ifelse(lag(year, default = "0") == year, "", year)
    ) %>%
    # select(name, year, n, value),
    select(year, n, value),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  align = c("r", "c"),
  caption = c
) %>%
  pack_rows("Certified Organic Beekeeper", 1, 6) %>%
  pack_rows("Migratory Beekeeper", 7, 9) # %>%
# kable_styling(font_size = 7)
tab
rm(cn, c, tab)
```

### Treatment Methods and Loss Rate

In the survey a total of 18 different treatment methods as varroa control were selectable by the participants and in addition as binary question the time of application. The treatment methods included 'Drone brood removal', 'Oxalic acid' (sublimation and mixture or pure trickling), 'Formic acid' (long or short term), 'Other biotechnical methods' (excluding drone brood removal and hyperthermia), 'Thymol', 'Hyperthermia', 'Lactic acid', 'Another method' and 'Synthetic methods' which were combined from the questions 'Amitraz (in strips or sublimation), Coumaphos (Perizin or Checkmite+) or Flumethrin (Bayvarol, Polyvar), Tau-fluvalinat (Apistan)' because of the low number of replies in Austria concerning this methods. The treatment methods are selected in accordance with COLOSS and the same list of treatment methods are used in every participating country [@vanderzee2013].

To generate treatment method combinations for participants the months were grouped following seasons 'Spring' (April-May), 'Summer' (June-October) and 'Winter' (November - January) [@oberreiter2020]. The months february and march of the next year were not used in the combinations. In addition to reduce the number of different treatment method combination the method 'Drone brood removal' was excluded, as it led to only low common combination. The estimate of loss rates of this treatment combinations were calculated as observed total loss rates based on equation (\@ref(eq:lossrate). 

```{=tex}
\begin{equation}
\begin{aligned}
\frac
    {
      \sum{\text{Loss of colonies}}-\sum{\text{Loss due to natural hazards}}
    }
    {
      \sum{\text{Colonies wintered}}
    }
      *100
\end{aligned}
(\#eq:lossrate)
\end{equation}
```

The reported 95% confidence interval (CI) were created for each analysed treatment combination from a separate null model, which was calculated using a Generalised Linear Model (GZLM) with quasi-binomial distribution and the link function \enquote{logit}. The generation was carried out according to scientifically established methods \citep{vanderzee2013}.

### Efficacy & Economical

To test if varroa treatment combinations, with at least 30 answers over all three years, are efficient and also economical the observed loss rates and reported mean expenses were plotted and grouped into four categories for each survey years. The categories are the combination of low or high losses (colony winter losses) and low or high price (expenses per colony) for each method. The assignment to this categories is based on the value for each treatment combination method in comparison to the total observed loss rate and total mean expenses per colony for each year. If the expenses for a method is lower or equal to the average it will get the category 'Low-Price' and if higher 'High-Price'. The same method applies to the loss rate, but here the treatment methods loss rates are compared to the total observed loss rate, see Fig. \@ref(fig:efficient-economic-mm) for a graphical explanation. This assignment was done for each year separately as I have no assumption if the same beekeepers participated in more than one survey.

```{r}
# we could do the geometric mean for costs to reduce effects of outliers, but the result is not straightforward interpretable and the mean is maybe more true in this case, as we already to a lot of pre filtering to reduce the outliers.
```

(ref:efficient-economic-mm) Graphical explanation of the assignment of efficacy and economical categories for the treatment methods. This assignment was done for each year separately.
```{r efficient-economic-mm, include=T, fig.cap="(ref:efficient-economic-mm)"}
include_custom("output/figs/efficient-economic-mm.png")
```

<!--chapter:end:02-mm.Rmd-->

# Results
## Survey Data
### Representative and distribution of sample

```{r, include=FALSE}
source("src/r-survey.R", local = knitr::knit_global())
```

The survey participants with valid answers including treatment expenses per colony represent between 3.5% and 4.0% of the beekeepers in Austria, when compared to the number of registered beekeeper and honey bee colonies as reported by the national beekeeping association 'Biene Österreich'.[^r-vis] In detail these are in the survey year 2018/19 with `r r_survey$response$rate_beekeeper[[1]]`% (n = `r format(r_survey$response$survey_colonies[[1]], big.mark = ",")`), survey year 2019/20 with `r r_survey$response$rate_beekeeper[[2]]`% (n = `r format(r_survey$response$survey_colonies[[2]], big.mark = ",")`) and 2020/21 with `r r_survey$response$rate_beekeeper[[3]]`% (n = `r format(r_survey$response$survey_colonies[[3]], big.mark = ",")`) (Table \@ref(tab:registered)). The distribution map with participants grouped by main winter apiary location on district level shows that the survey covers most districts in Austria in the three survey years. The distribution of beekeepers between the districts is not the same which could reflect real beekeeper density and/or a possible participation bias, although the size of districts is also not equal (Fig. \@ref(fig:distr-map)).

[^r-vis]: In Austria the registration of beekeepers, apiaries and honeybee colonies in the Consumer Health Information System (Verbrauchergesundheitsinformationssystem - VIS) has been implemented into the national Animal Identification and Registration Regulation 2009 (Tierkennzeichnungs- und Registrierungsverordnung, § 1 TKZVO 2009 idF II 193/2015) from 8th of July 2015.

```{r registered, include=T}
cn <- c("Year", "Total", "Survey", "%", "Total", "Survey", "%")
c <- "Percentage of survey participants in relation to the number of beekeepers in Austria as reported by the national beekeeping association 'Biene Österreich'."
tab <- knitr::kable(
  r_survey$response %>%
    select(year, beekeeper, survey_beekeeper, rate_beekeeper, colonies, survey_colonies, rate_colonies),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  caption = c
) %>%
  kableExtra::add_header_above(c("", "Beekeeper [n]" = 3, "Colonies [n]" = 3))
tab
rm(tab, c, cn)
```

```{r distr-map, include=T, fig.cap="Distribution map of the participants main winter apiary on district level. Shapefiles under Creative Commons https://www.data.gv.at/"}
include_custom("output/figs/map.png")
```

The reported expenses per colony arithmetic mean (`r paste(range(r_survey$summary$survey_table$mean), collapse = "-")` Euro) and median (`r paste(range(r_survey$summary$survey_table$median), collapse = "-")` Euro) is similar between the three survey years (Table \@ref(tab:central)). The arithmetic mean is higher than the median, due to the right skewed data distribution with some high values above 100 Euro (Fig. \@ref(fig:distr-year)). The distribution density of the reported expenses are similar between the three survey years and show that participant did answer in round full numbers eg. 5.00, 10.00, 15.00 Euros (Fig. \@ref(fig:distr-year)).


(ref:distr-year) Distribution of the expenses for each survey year, values above 50 are not visible. First graph column represents the actual data points, second column a boxplot with median and interquantile range (IQR, $25^{th}$ - $75^{th}$ quantile) and vertical lines 1.5*IQR. Last column is density distribution of the data points. Different years are colour coded (orange = 2018/19, green = 2019/20, blue = 2020/21).

```{r distr-year, out.width="100%", include=T, messages=F, warnings=F, fig.cap="(ref:distr-year)"}
include_custom("output/figs/distr-year.png")
```

```{r central, include=T}
cn <- c("Year", "Minimum", "Mean", "Geom. Mean", "Median", "Max", "n")
c <- "Survey central tendency values for treatment expenses per colony for all years and additionally over all years. Column 'Mean' is the arithmetic mean, the 'Geom. Mean' (geometrical mean) was added as alternative to reduce the effect of positive outliers."
tab <- knitr::kable(
  dplyr::bind_rows(r_survey$summary$survey_table, r_survey$summary$survey_total) %>%
    select(-type) %>%
    mutate(
      year = ifelse(year == "total", "All Years", paste0("20", year))
    ),
  align = c("l", rep("r", 5)),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  # format = "markdown",
  caption = c
) %>%
  kableExtra::row_spec(3, hline_after = TRUE)
tab
rm(tab, c, cn)
```

### Distribution of Participants for Operational Questions

As overview for correlation and distribution of the included operational factors of interest, the participants where grouped into bins of combination of these factors (Fig. \@ref(fig:distr-groups)). The two survey questions 'Migratory Beekeeper' and 'Certified Organic Beekeeper' did include as possible answers 'Yes', 'No' and 'Uncertain', whereas 'Uncertain' and participants which did not answer on these questions were ignored. The answer on operation size (number colonies going into winter, any positive integer number was possible) was grouped into the two levels, 'Recreational Beekeepers' with 25 or less colonies and 'Professional Beekeeper' with more colonies. Based on these three operational questions the most common and dominating group in the survey are recreational beekeepers, who are neither migratory or certified organic with 63-65%. Second most are professional beekeepers with more than 25 colonies with 8-11%. All other combinations of these operational factors are below 10% in each survey year. A small decline in recreational beekeepers which report to migrate their colonies can be seen over the three survey years (2018/19: 7,7%; 2019/20: 6.2%; 2020/21: 5.4%) (Fig. \@ref(fig:distr-groups)).

```{r distr-groups, include=T, messages=F, warnings=F, fig.cap="Count and distribution of participants grouped into operational factors and their combination for each year. The three operational factors and combination bins are below the bar plots, whereas black dots indicate 'Yes'/'True' for given factor. Percentage reported above the bars stands respectively for the survey years 2018/19, 2019/20 and 2020/21. Recreational Beekeepers are participants with 25 or less colonies going into winter.", out.width="100%"}
include_custom("output/figs/distr-groups.png")
```

<!--chapter:end:03-results-1-survey.Rmd-->

## Motivation choosing Varroa control method

```{r, include=FALSE}
source("src/r-motivation.R", local = knitr::knit_global())
```

The question "Which main motivations are most likely to apply to you when choosing the Varroa control method (max. 5)?" was only asked in the survey 2020/21, with a total of `r r_motivation$answers` valid answers. Even though it was possible to pick up to 5 answers, the most common answer was "Recommendations from beekeeping associations, extension workers, veterinarians, magazines, etc.", followed up by answers all including "Efficacy", see table \@ref(tab:motivation-comb). A longer list with the top 25 combinations is available in the appendix (tab. \@ref(tab:motivation-comb-full)). The dominant answer "Efficacy" can be seen in figure (fig:motivation-count), were "Efficacy" was the most often picked by above 60% of the participants, followed by "Side effects on bees" and "Residues". The answer "Costs", which is the main topic of my research question, was only picked by 6.8% beekeepers. If separate into states "Efficacy" followed by "Side effects on bees" was the most answered. The third place is different between the states with "Residues" for Lower and Upper Austria, Burgenland, Salzburg, Styria and Tyrol and "Legal status" for Vienna and Carinthia. In the state of Vorarlberg the answer "Colony Infestation Level (Varroa)" was the third most (figure \@ref(fig:motivation-state)). 

```{r motivation-comb, include=T}
cn <- c("Motivation", "Answers", "Motivations")
c <- "Top 10 answers given by participants and the chosen combinations if multiple answers were selected. 'Answers' is the count this combination was picked and 'Motivations' are the number of different answers."
tab <- knitr::kable(
    r_motivation$comb_list %>% select(motivation, n, motivations) %>% dplyr::slice_max(n, n = 10),
    align = c("l", rep("r", 2)),
    booktabs = TRUE,
    row.names = FALSE,
    col.names = cn,
    # format = "markdown",
    caption = c
) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(tab, c, cn)
```

```{r motivation-count, include=T, messages=F, warnings=F, fig.cap="Total count of all 21 motivation answers for choosing varroa control method. Percentage is the relative amount of participants which did pick this motivation as one of their answers, number in brackets is the total count how many the answer was picked.", out.width="100%"}
include_custom("output/figs/motivation-count.png")
```

```{r motivation-state, include=T, messages=F, warnings=F, fig.cap="Top five motivation answers for choosing varroa control method. Stacked bar plot, representing answers for each state in Austria in relative amount to the total answers for this motivation question. Numbers in bars are in relative number of answers in procent. White background numbers indicate highest and lowest state for given motivation answer.", out.width="100%"}
include_custom("output/figs/motivation-state.png")
```

<!--chapter:end:03-results-2-motivation.Rmd-->


## Expenses Estimations {#r-estimations}

```{r, include=FALSE}
source("src/r-estimate.R", local = knitr::knit_global())
if (file.exists("output/r-extrapolation.rds")) {
    r_extrapolation <- readRDS("output/r-extrapolation.rds")
} else {
    source("src/r-extrapolation.R", local = knitr::knit_global())
    saveRDS(r_extrapolation, "output/r-extrapolation.rds")
}
```

The calculated estimated expenses mean and median are higher but similar in each year, than in the survey given by participants, see table \@ref(tab:table-estimates). The most common combinations, without drone brood removal, over the survey years and the corresponding estimates can be seen in table \@ref(tab:common-comb). For the tables the estimated expenses are calculated for each beekeeper in the survey and then the average was taken as with the survey expenses.

```{r table-estimates, include=T}
c <- "Comparison of estimated expenses and the expenses given by participants in the survey. All values are in Euro."
cn <- c("", "Min.", "Mean", "Median", "Max")
tab <- kable(
    r_estimate$table %>% select(-type),
    align = c("c", rep("r", 4)),
    booktabs = TRUE,
    row.names = FALSE,
    col.names = cn,
    caption = c
) %>%
    pack_rows("Estimate", 1, 3) %>%
    pack_rows("Survey", 4, 6)
tab
rm(c, cn, tab)
```

```{r common-comb, include=T}
c <- "Top 11 most used treatment combination for all three survey years. Total and Percent correspond to participants. Mean and median expenses from the survey and in comparison to the estimate in Euro. Drone brood removal method is excluded from the combinations."
cn <- c("Method", "Total [n]", "Percent [%]", "Mean", "Median", "Mean", "Median")
kable(
    r_estimate$data %>% dplyr::slice_max(n, n = 10) %>% select(c_short_od:med_estimate),
    booktabs = TRUE,
    row.names = FALSE,
    digits = 1,
    col.names = cn,
    caption = c,
    linesep = c("", "", "", "", "\\addlinespace"),
) %>%
    add_header_above(c(" " = 3, "Survey" = 2, "Estimate" = 2)) %>%
    footnote(threeparttable = T, general = "SP/SU/WI = Spring/Summer/Winter || AS-LT/ST = Formic acid - long/short term || Ox-sub/pure/mix = Oxalic acid - sublimation, pure or mixture || Biot = Another biotechnical methods.") %>%
    kable_styling(font_size = 8)
rm(c, cn, d)
```

Most of our estimates for common treatment with at least 10 participants using the combination of methods are overestimated. This can be seen if we plot the mean differences, of survey expenses versus estimated expenses as statistical method of agreement [@bland1986]. $\log_2$ converted to minimizes effect of high expense differences between treatment methods, see figure \@ref(fig:estimates-bland).

The $\log_2$ change can be seen as follows, one represent a double of the original and minus one is half of the original on the transformed scale. Each treatment combination is inside the 95% confidence interval of the upper and lower two times standard deviations from the mean difference. Combinations which include formic acid short-term are above the upper two times standard deviation limit, which means the survey responses are higher roughly ~1.7 times higher that the calculated estimates. Overall there are more overestimates of calculated estimates and the results coming from the survey are lower on average lower, which is indicate by the negative mean difference (figure \@ref(fig:estimates-bland), yellow line). The two combinations with the higher overestimating and outside of the two times standard deviation limit are both including a biotechnical treatment method in summer.

(ref:estimated-bland) $\log_2$ transformed mean difference between survey and estimated expenses of the treatment combinations with at least 10 beekeepers using it, over the three years of survey. Lines indicating mean and lower and upper two times standard deviations each with 95% confidence interval. Point size is the frequency count of each treatment method. Treatment combination above the two times standard deviations are colour coded and labeled, the label meaning is explained in \@ref(tab:common-comb).

```{r estimates-bland, include=T, fig.cap="(ref:estimated-bland)", out.width="100%"}
include_custom("output/figs/bland-altman.png")
```

### Expenses Extrapolation

The rough extrapolation of the survey mean expenses with the total sum of colonies in Austria is based on the reported numbers by the national beekeeping association "Biene Österreich"[^r-vis]. This extrapolation with the arithmetic mean sum in 2018/19 to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[1], big.mark = ",")` Euro (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[1], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[1], big.mark = ",")`), 2019/20 to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[2], big.mark = ",")` Euro (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[2], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[2], big.mark = ",")`) and 2020/21 to to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[3], big.mark = ",")` Euro (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[3], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[3], big.mark = ",")`) (table \@ref(tab:extrapolation-tab), figure \@ref(fig:extrapolation)).
In addition the same extrapolation was calculated with the geometric mean, in this case zero values in the dataset were replaced with 0.01 Euro. The geometric mean is less influenced by outliers and unit less. The confidence intervals are based on the logarithmic distribution (REFERENZ?). The extrapolation with the geometric mean sum in 2018/19 to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[4], big.mark = ",")` (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[4], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[4], big.mark = ",")`), 2019/20 to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[2], big.mark = ",")` (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[5], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[5], big.mark = ",")`) and 2020/21 to to `r format(r_extrapolation$data %>% pull(extrapolation_estimate)%>% .[3], big.mark = ",")` (95% CI: `r format(r_extrapolation$data %>% pull(extrapolation_estimate_lower)%>% .[6], big.mark = ",")` - `r format(r_extrapolation$data %>% pull(extrapolation_estimate_upper)%>% .[6], big.mark = ",")`) (table \@ref(tab:extrapolation-tab), figure \@ref(fig:extrapolation)).


```{r extrapolation-tab, include=T}
c <- "Extrapolation with multiplication of the average treatment expenses per colony with the reported number of survey colonies wintered and number of colonies for Austria as reported from the national beekeeping association 'Biene Österreich'. Confidence intervals for point estimates are calculated with 1,000 bootstrap resamples. Two methods applied arithmetic mean and geometric mean."
cn <- c("Year", "Mean [Euro]", "CI Lower", "CI Higher", "Colonies [n]", "Mean Sum [Euro]", "Colonies [n]", "Mean Sum [Euro]")
kable(
    r_extrapolation$data %>%
        select(year, statistic, conf.low, conf.high, colonies_survey, survey_estimate, colonies, extrapolation_estimate) %>%
        mutate(
            across(statistic:conf.high, round, digits = 2),
            across(colonies_survey:extrapolation_estimate, round)
        ),
    align = c("c", rep("r", 7)),
    booktabs = TRUE,
    row.names = FALSE,
    col.names = cn,
    caption = c,
    escape = TRUE,
) %>%
    add_header_above(c(" " = 4, "Survey" = 2, "Extrapolation" = 2)) %>%
    pack_rows("Arithmetic Mean", 1, 3) %>%
    pack_rows("Geometric Mean", 4, 6) %>%
    kable_styling(latex_options = "scale_down")
rm(c, cn)
```

(ref:extrapolation) Extrapolation with multiplication of the average treatment expenses per colony with the reported number of survey colonies wintered and number of colonies for Austria as reported from the national beekeeping association 'Biene Österreich'. Confidence intervals for point estimates are calculated with 1,000 bootstrap resamples. Two methods applied arithmetic mean and geometric mean. Basis of the calculation are the mean expenses for one colony, see table \@ref(tab:extrapolation-tab).
```{r extrapolation, include=T, fig.cap="(ref:extrapolation)", out.width="100%"}
include_custom("output/figs/extrapolation.png")
```

<!--chapter:end:03-results-3-estimate.Rmd-->

## Operational factor analysis
```{r, include=FALSE}
if (file.exists("output/r-operational.rds")) {
    r_operational <- readRDS("output/r-operational.rds")
} else {
    source("src/r-operational.R", local = knitr::knit_global())
}
```

Most questions in the survey are related to winter colony losses but two operational questions could give more insight into the expenses spend by beekeepers for their treatment method. This two are if the beekeeper migrates with his colonies and if it is an organic certified beekeeping operation, with possible answers "Yes", "No". If survey participants did answer "Unsure" or did not answer at all it was not used for the factor analysis. Additionally I look at the operation size, which can also be seen as operational questions.

### Operation size

Operation sizes and number of participants in our survey are not normally distributed, with most participants managing less than 20 colonies and a few big operation with over one hundred colonies, see figure \@ref(fig:size-distr). The participants were grouped into two groups, beekeepers with 25 or less colonies, which should represent recreational beekeepers, and the ones with more than 25 colonies, which should represent side-line and professional operations (table \@ref(tab:size-table)). The given operation size groups show statistical significant difference in all survey years, whereas the smaller beekeeping operations spend on average and median more per colony as the beekeepers with more than 25 colonies (figure \@ref(fig:size-stats)). The absolute median difference between the groups is between `r min(r_operational$size$statistic_perm$point_estimate %>% unlist())` and `r max(r_operational$size$statistic_perm$point_estimate %>% unlist())` Euro per colony. 


(ref:size-distr) Distribution of operation size over the three survey years. Colonie numbers based on the reported colonies going into winter.

```{r size-distr, include=T, fig.cap="(ref:size-distr)", out.width="100%"}
include_custom("output/figs/size-distr.png")
```

```{r size-table, include=T}
c <- "Operation size distribution and measures of central tendency over the three survey years."
cn <- c("Operation Size", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")
tab <- kable(
    r_operational$size$table %>% select(-year),
    booktabs = TRUE,
    col.names = cn,
    digits = 1,
    align = c("c", rep("r", 4)),
    caption = c
) %>%
    pack_rows("2018/19", 1, 2) %>%
    pack_rows("2019/20", 3, 4) %>%
    pack_rows("2020/21", 5, 6) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

(ref:size-stats) Boxplot and test results of expenses in the two given operation size groups, with median difference based on permutation test and bootstrap confidence interval of the difference. Exact *p*-value and test results see fig. \@ref(fig:size-permutation). Gray points indicating individual datapoints, survey answers above 80 euros per colony are not shown. Pink rhombus indicating mean of sample group. Pairwise comparison of mean between groups are given as label above the boxplots.

```{r size-stats, include=T, fig.cap="(ref:size-stats)", out.width="100%"}
include_custom("output/figs/size-stats.png")
```

### Certified organic beekeeping operation

Only `r r_operational$organic$summary$np[[2]]`% of the survey participants are certified organic, see table \@ref(tab:organic-table). Participants who are a certified organic operation have signifikant lower treatment expenses per colony on average and median than participants without certificate \@ref(fig:organic-stats). The absolute median difference between the groups is between `r min(r_operational$organic$statistic_perm$point_estimate %>% unlist())` and `r max(r_operational$organic$statistic_perm$point_estimate %>% unlist())` Euro per colony.

```{r organic-table, include=T}
c <- "Certified organic beekeeping operation distribution and measures of central tendency over the three survey years."
cn <- c("Certified Organic", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")
tab <- kable(
    r_operational$organic$table %>% select(-year),
    booktabs = TRUE,
    col.names = cn,
    digits = 1,
    align = c("c", rep("r", 4)),
    caption = c
) %>%
    pack_rows("2018/19", 1, 2) %>%
    pack_rows("2019/20", 3, 4) %>%
    pack_rows("2020/21", 5, 6) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

(ref:organic-stats) Boxplot and test results of expenses in if survey participant is certified organic or not, with median difference based on permutation test and bootstrap confidence interval of the difference. Exact *p*-value and test results see fig. \@ref(fig:size-permutation). Gray points indicating individual datapoints, survey answers above 80 euros per colony are not shown. Pink rhombus indicating mean of sample group. Pairwise comparison of mean between groups are given as label above the boxplots.

```{r organic-stats, include=T, fig.cap="(ref:organic-stats)", out.width="100%"}
include_custom("output/figs/organic-stats.png")
```

### Migratory beekeeper

The beekeepers participating in our study were asked whether they transported their bees to sources of honey yields or for pollination service (this excludes movements in the course of breeding or splits). A total of `r r_operational$migratory$summary$np[[2]]`% of the survey participants are migrating with their colonies, see table \@ref(tab:migratory-table). Participants who migrate their colonies have signifikant lower treatment expenses per colony on average and median than non-migratory beekeepers \@ref(fig:migratory-stats). The absolute median difference between the groups is between `r min(r_operational$migratory$statistic_perm$point_estimate %>% unlist())` and `r max(r_operational$migratory$statistic_perm$point_estimate %>% unlist())` Euro per colony.

```{r migratory-table, include=T}
c <- "Migratory beekeeper distribution and measures of central tendency over the three survey years."
cn <- c("Migratory Beekeeper", "Beekeeper [n]", "Colonies [n]", "Mean [Euro]", "Median [Euro]")
tab <- kable(
    r_operational$migratory$table %>% select(-year),
    booktabs = TRUE,
    col.names = cn,
    digits = 1,
    align = c("c", rep("r", 4)),
    caption = c
) %>%
    pack_rows("2018/19", 1, 2) %>%
    pack_rows("2019/20", 3, 4) %>%
    pack_rows("2020/21", 5, 6) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

(ref:migratory-stats) Boxplot and test results of expenses in if migratory beekeeping operation or not, with median difference based on permutation test and bootstrap confidence interval of the difference. Exact *p*-value and test results see fig. \@ref(fig:size-permutation). Gray points indicating individual datapoints, survey answers above 80 euros per colony are not shown. Pink rhombus indicating mean of sample group. Pairwise comparison of mean between groups are given as label above the boxplots.

```{r migratory-stats, include=T, fig.cap="(ref:migratory-stats)", out.width="100%"}
include_custom("output/figs/migratory-stats.png")
```

<!--chapter:end:03-results-4-single-factor.Rmd-->

## Multiple Regression

Starting with the base model including only the reported number of colonies wintered ($log_{10}$), the linear regression model did improve by adding the operational factors and treatment methods. Adding states as covariate did improve the $R^2$ value (0.142) but showed higher AIC and BIC, indicating that the penalization of the additional factors is higher than the gain and could lead to possible overfitting \@ref(tab:model-table). The best model with lowest AIC and BIC scores was with all predictors without states (AIC: 1844, BIC: 1939). The residual of the best model fit show a normal distribution (Appendix Fig: \@ref(fig:model-qq-residuals)).

```{r model-table, include=T}
c <- "Summary of model fit. Base model only includes number of colonies wintered, operational the two questions migratory beekeeper and certified organic beekeeper. The eleven treatment methods are binary encoded, excluded is drone brood removal."
cn <- c("Model", "$R^2$", "adj. $R^2$", "df", "logLik", "AIC", "BIC")
tab <- kable(
    r_model$fitted %>%
        mutate(
            model = c("Intercept", "Base", "$+$ Operational", "$+$ Treatment Methods", "$+$ States"),
            df = ifelse(is.na(df), 0, df),
            across(logLik:BIC, round)
        ) %>%
        select(model, r.squared, adj.r.squared, df:BIC),
    booktabs = TRUE,
    col.names = cn,
    digits = 3,
    align = c("l", rep("r", 9)),
    caption = c,
    escape = FALSE
) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

The intercept of the best model, which would be a hypotheical beekeeper without any colonies, no migratory, no certified organic and no applied treatments is at `r round(r_model$coeff_intercept[2], 2)` Euro (SE: `r round(r_model$coeff_intercept[1], 2)`). 

```{r model-best, include=T}
c <- "Summary of the coefficients of the selected best model and statistic results. Terms starting with 'T.' are treatment methods. Significant stars are labeled based on the p-value (*** < 0.001, ** < 0.01, * <= 0.05, n.s. (not significant) > 0.5). SE = Standard Error."
cn <- c("Term", "Estimate", "SE", "Statistic (t)", "p", "")
tab <- kable(
    r_model$coeff %>%
        mutate(
            tname = str_replace(tname, "T.", "T."),
            p.star = case_when(
                p.value < 0.001 ~ "***",
                p.value < 0.01 ~ "**",
                p.value <= 0.5 ~ "*",
                TRUE ~ "n.s."
            ),
            p.value = ifelse(
                p.value > 0.5,
                base::format(round(p.value, 2), digits = 3, scientific = FALSE, nsmall = 1),
                base::format(p.value, digits = 3, scientific = TRUE, nsmall = 1)
            ),
        ) %>%
        select(tname, estimate:p.value, p.star),
    booktabs = TRUE,
    col.names = cn,
    digits = 3,
    align = c("l", rep("r", 4), "c"),
    caption = c
) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

```{r model-whisker, include=T, fig.cap="Geometric mean estimate and standard error as dot-and-whisker plot of the best model regression coefficients without intercept. Coefficients ordered by estimate value. Color coded if regression direction is negative (green) or positive (red). Coefficients starting with 'T.' are treatment methods.", out.width="100%"}
# I write geometric mean because back transformation of log transformed data is actually the same as the geometric mean
# abstract: https://www.researchgate.net/publication/5402553_The_logarithmic_transformation_and_the_geometric_mean_in_reporting_experimental_IgE_results_What_are_they_and_when_and_why_to_use_them
include_custom("output/figs/model-whisker.png")
```

The predictive ability of our model and selected predcitors is low with an accuracy based on correlation between observed and predicted in the training set of `r round(r_model$performance_accuracy_best$Accuracy, 2)`% (SE: `r round(r_model$performance_accuracy_best$SE, 2)`). The root mean square error for the training dataset (rmse = `r r_model$prediction_stats %>% filter(type == "Training") %>% pull(.estimate) %>% round(., 2)`) and testing set (rmse = `r r_model$prediction_stats %>% filter(type == "Testing") %>% pull(.estimate) %>% round(., 2)`) are similar, showing low probability of overfitting (Fig. \@ref(fig:model-pred)).

```{r model-pred, include=T, fig.cap="Model prediction of expenses on training and testing dataset. Orange and blue line are linear fit with standard error of intercept only model without any predictors and selected best model. Red line represents theoretical line of perfect fit.", out.width="100%"}
include_custom("output/figs/model-pred.png")
```










<!--chapter:end:03-results-5-model.Rmd-->

## Treatment Methods Overview

```{r, include=FALSE}
if (file.exists("output/r-treatment.rds")) {
    r_treatment <- readRDS("output/r-treatment.rds")
} else {
    source("src/r-treatment.R", local = knitr::knit_global())
    saveRDS(r_treatment, "output/r-treatment.rds")
}
```


```{r efficient-economic, include=T, fig.cap="Treatment combinations 20 participants reporting it over the three years. ", out.width="100%"}
include_custom("output/figs/efficient-economic.png")
```


```{r ee-table, include=T}
c <- "test"
cn <- c(" ", "Treatment", "Year", "Median", "Mean", "SD", "Mean", "Lower CI", "Upper CI", "Efficient", "Economical")
cell_colors_price <- c("high-price" = "cred!80", "low-price" = "cgreen!80")
cell_colors_loss <- c("high-loss" = "cred!80", "low-loss" = "cgreen!80")

tab <- kable(
    r_treatment$tab %>%
        mutate(
            c_short_od = str_replace_all(c_short_od, "&", " \\\\& "),
            across(letter:c_short_od, ~ ifelse(lag(as.character(.x), default = "0") == .x, "", .x)),
            across(observed_costs:observed_costs_sd, ~ ifelse(lag(.x, default = 0) == .x, "", round(.x, 2)))
        ) %>%
        mutate(
            letter = cell_spec(letter, bold = TRUE),
            efficient = cell_spec(
                efficient,
                background = cell_colors_loss[efficient]
            ),
            economical = cell_spec(
                economical,
                background = cell_colors_price[economical]
            )
        ),
    linesep = c("", "", "\\addlinespace"),
    booktabs = TRUE,
    col.names = cn,
    digits = 1,
    align = c("c", "l", "c", rep("r", 5), "c", "c"),
    caption = c,
    escape = FALSE
) %>%
    add_header_above(c(" " = 3, "Expenses" = 3, "Observed Loss Rate" = 3, " " = 2)) %>%
    # landscape()
    kable_styling(latex_options = "scale_down")
tab
rm(cn, c, tab)
```

<!--chapter:end:03-results-6-treatment.Rmd-->

# Discussion

## Estimates






## Limitations and Sample Representative 

The survey was only online available and was not mandatory. Therefore, we cannot say that our sample represents the beekeeper population in Austria as the sample was not selected randomly from the population [@vanderzee2013]. In Austria all Beekeeprs must officially register with the "Veterinärinformationssystem" part of the Statistics Austria, but access to this data is limited and only available for prevention of diseases and therefore we cannot use this dataset to select a random sampel of the beekeepers population. Therefore, estimates should be viewed with cautions, and could have a potential selection biases and survey errors [@heeringa2010]. The experience from previous surveys results about the colony losses and the relatively high participation rate and different operation sizes are still a good indicator for a good sample.


In the evaluation, no correction is made for the accumulation of the alpha error, since different hypotheses are tested in our questionnaire and possible overlaps of the hypotheses are difficult to classify. Therefore, we try to keep the same questions over several years to reduce the probability of error in the statistics. An analysed risk factor that shows a significant influence on winter losses over several years probably has a stronger significance. However, analysed factors may also be subject to a correlation with an annual variable such as weather \citep{switanek2017}.

<!--chapter:end:04-disc.Rmd-->

# Appendix {-}

```{r motivation-comb-full, include=T}
cn <- c("Motivation", "Answers", "Motivations")
c <- "Top 25 answers given by participants and the chosen combinations if multiple answers were selected. 'Answers' is the count this combination was picked and 'Motivations' are the number of different answers."
tab <- knitr::kable(
    r_motivation$comb_list %>% select(motivation, n, motivations) %>% dplyr::slice_max(n, n = 25),
    align = c("l", rep("r", 2)),
    booktabs = TRUE,
    row.names = FALSE,
    col.names = cn,
    # format = "markdown",
    caption = c
) %>%
    kable_styling(latex_options = "scale_down")
tab
rm(tab, c, cn)
```


(ref:size-permutation) Median difference null distribution (gray bars) based on 5,000 permutations. Red Line point estimate for median difference, yellow area 95% confidence interval of point estimate. Red shadow indicating the calculated two-sided *p*-value range on the null distribution. If *p*-value is reported as "\*\*\*" more permutation would be needed to calculate a precise *p*-value.

```{r size-permutation, out.width="80%", include=T, fig.cap="(ref:size-permutation)"}
include_custom("output/figs/size-permutation.png")
```

```{r organic-permutation, out.width="80%", include=T, fig.cap="(ref:size-permutation)"}
include_custom("output/figs/organic-permutation.png")
```

```{r migratory-permutation, out.width="80%", include=T, fig.cap="(ref:size-permutation)"}
include_custom("output/figs/migratory-permutation.png")
```

```{r model-qq-residuals, out.width="50%", include=T, fig.cap="Distribution of model residuals after fitting from the selected best model on the training dataset."}
include_custom("output/figs/model-qq-residuals.png")
```

<!--chapter:end:05-appendix.Rmd-->

