
```{r load-files, warning=F, echo=F, include=F}
source("src/setup.R", local = knitr::knit_global())
source("src/mm-cleanup.R", local = knitr::knit_global())
```

# Material and Methods
## Survey

The survey is a citizen science survey which is done each year in spring since 2008. It is a combination of online, beekeeping journal and paper submission. The main focus and question of the survey is the yearly colony losses over winter for the Austrian Beekeeper. The survey is part of the COLOSS questionnaire and most questions are in accordance with the other countries [@vanderzee2013]. The questions are simple and relate to possible risk factors which may influence overwintering success and as seen in other studies [@oberreiter2020]. The survey is not mandatory but beekeepers who want to get more official support they need a certified that they participated in the survey.

As most questions are related to winter colony losses I am only interested in an subset of questions: Number of colonies wintered (size of operation), Number of colonies lost over winter period (due natural or queen loss, without losses due to natural disaster), state and district of main wintering apiary (as possible covariate), month(s) and type of treatment used, estimated treatment expenses per colony without labor costs. In addition two operational questions are also explored, if the beekeeper migrates with his colonies and if he/she is an organic certified beekeeper, with possible answers "Yes", "No", "Unsure".

All questions are explored in combination with the expenses per colony, this questions was only available in the Austrian questionnaire and here only in the online survey as the questionnaire printed in the beekeeping journal and handed out paper submissions are a shorter version.

To further understand why participants choose their varroa control method, the last survey year (winter 2020/21) did also include the question: "Which main motivations are most likely to apply to you when choosing the Varroa control method (max. 5)?". The possible answers, which were abitrary defined by us, were displayed in a randomized order and included: "Habit", "Economic costs", "Marketing", "Subsidies", "Prescription", "Philosophy", "Efficacy", "Method applicable with and without brood", "Time of season where they can be applied", "Colony strength", "Colony infestation level (Varroa)", "Environmental conditions", "Recommendations from beekeeping associations, extension workers, veterinarians, magazines, etc.", "Legal status (regulatory framework)", "Availability of products", "Resistances", "Residues",  "Side effects on bees", "Level of difficulty and needed  equipment", "Time and number of applications", "Other". This question as only available in the online survey and `r length(mmList$motivation$no_answer)` participants did choose not to answer this question, which leaves `r mmList$motivation$valid_answers` valid answers to this new question.

The survey was anonymous and private data like IP addresses were only used in the first step to help identify double entries. If voluntary contact details were given, the data was anonymised prior analysis and only used if further inquire on questionable answers was necessary.

As I analyzed three continuous survey years and the survey is anonymous I have no assumption if the same beekeepers participated in more than one survey. Only for the handful of beekeepers who did always give the same contact details. Therefore, I can not say that both years are independent or not and analyzed them separately or use year as random effect. The advantages to compare multiple years is, that I may have a better overview if the survey is representative, as there should not much change in the expenses and distribution of beekeepers apiary location and size of operations over the survey years. Furthermore, overall winter loss rates fluctuate between years of survey. This means I can check if a given treatment did result in both years in low/high winter mortality or not.

## Expenses Estimation

Expenses estimation was carried out to check if a logical expenses estimation of products yield the same result as the participants answers. To calculate estimates I researched online store prices in 2020 in Austria for official registered medication[^mm-1] and used common application amount from beekeeping school materials and manufacturer instructions, see table \@ref(tab:standard-cost). An example calculation, based on \@ref(eq:estimate-calculation), with the given estimates, with average month of usage and an estimated of 10 colonies can be seen in \@ref(tab:common). 

```{=tex}
\begin{equation}
\begin{aligned}
  \text{estimate per colony} = (\text{investment} / \text{total colonies}) + \text{material} + \text{consumable} * \text{months}
\end{aligned}
(\#eq:estimate-calculation)
\end{equation}
```

With this method for each survey participants an estimate was calculated with the individual given answer for treatment method (or combination), number of colonies and number of months used.

[^mm-1]: Austrian medicinal product index: <https://aspregister.basg.gv.at/>, accessed November 2020

```{r standard-cost, include=T}
c <- "Our calculated estimates for treatment expenses per method. Investments can be used long term (we calculate 10 years, eg. Hyperthermia) and are divided by the number of colonies. Material can also be used long term (7 years, eg. Queen Cages) but needs to be bought for each colony. Consumables are used for each colony (eg. Formic Acid Long Term, 200ml)."
cn <- c("Methode", "Investment", "Material", "Consumables")
kable(
  treatmentList[-1, c(3, 5:7)],
  booktabs = TRUE,
  row.names = FALSE,
  format = "markdown",
  caption = c,
  col.names = cn
) %>%
  footnote(threeparttable = T, general = "Synthetic methods are combined and include Amitraz, Coumaphos, and other synthetic methods; Other biotechnical methods do not include drone brood removal or hypothermia and Another method excludes synthetic methods.")

rm(c, cn)
```

```{r common, include=T}
# colonies based for estimate
m_colonies <- 10
col <- dfData %>%
  select(!!(paste0(treatmentList$ttotal, "12")))
# Get number of participates using the single treatment methods
sin <- col %>%
  mutate(across(.cols = everything(), as.logical)) %>%
  colSums()
# get the average amount for number of months
nu <- col %>%
  na_if(0) %>%
  colMeans(na.rm = T)

common_single <- tibble(
  tname = treatmentList$tname,
  n = sin,
  p = round(sin * 100 / nrow(dfData), 2),
  nu = round(nu, 2),
  est = round(treatmentList$investment / m_colonies + treatmentList$material + treatmentList$consumables * nu, 2)
) %>% arrange(desc(p))

c <- paste0("Treatment methods ordered by usage in the three survey years, months indicating the average of months this methods was used. Estimated costs per colony are calculated with ", m_colonies, " colonies, which represents the median number of colonies in our survey, and the average months of usage.")

cn <- c("Method", "Total [n]", "Percent [%]", "Average Months [n]", "Estimated Costs")
kable(
  common_single[-1, ],
  booktabs   = TRUE,
  row.names = FALSE,
  col.names  = cn,
  format = "markdown",
  caption    = c
) # %>% kable_classic()
rm(cn, c, common_single, nu, sin, col, m_colonies)
```

## Data Cleanup

### Newspaper and Paper Submission

The short version of the survey, which was printed in a beekeeping journal and paper handout submissions, did not include the question about expenses and, therefore, were excluded. That concern a total of `r sum(mmList$submitted_all %>% filter(submitted != "Internet") %>% pull(n))` submission from `r sum(mmList$submitted_all$n)` over the three years of survey. Though there is one exception which was kept to this, as one person did send a filled out paper handout of the online survey.

### No Answers on Expenses

Not all participants did answers the question on expeneses even when they had the possiblity to do so. These participates were also excluded as this question is the main focus of the study. In numbers these are in 2018/19 a total of `r mmList$internet_no_answer %>% filter(year == "18/19") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "18/19") %>% pull(np)`%), 2019/20 a total of `r mmList$internet_no_answer %>% filter(year == "19/20") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "19/20") %>% pull(np)`%) and in the last survey year 2020/21 a total of `r mmList$internet_no_answer %>% filter(year == "20/21") %>% pull(nn)` (`r mmList$internet_no_answer %>% filter(year == "20/21") %>% pull(np)`%) answers.

### No Treatment

Only `r nrow(mmList$no_treatment %>% filter(costs == 0))` participants did no treatment against the varroa mite and answered with zero expenses. In addition `r nrow(mmList$no_treatment %>% filter(costs > 0))` participants answered that they did no treatment but have included expenses for varroa treatment. This illogical entries and the participants with zero costs and the before mentioned no treatment answers were removed from the data analysis. 

### No Methods

In total `r nrow(mmList$no_method)` participants did answer varroa expenses (min. `r min(mmList$no_method$costs)`, max. `r max(mmList$no_method$costs)` Euro per colony) and said they treated against varroa but did not specify their treatment method. I decided to remove them from them from the dataset, as it was only a small number and I could not further validate the answers or use it for the statistics which also involved treatment methods.

### Zero Expenses

In total `r nrow(mmList$cost_zero$data)` participants said their treatment expenses were zero. Only one answer were kept, as the treatment was a combination of hyperthermia and biotechnical and I can make no assumption about the real expenses of the participant. Ofcourse the equipment for the hyperthermia do cost something, but we don't know more details, as he could already have the equipment for a long time. This means a total of `r length(mmList$cost_zero$id_remove)-length(mmList$cost_zero$id_sponsor)` were removed as they said zero expenses but actually did treatment with organic acids, which is illogical as the organic acids are consumed and not for free. Additionally `r length(mmList$cost_zero$id_sponsor)` participants got a sponsorship (beekeeping club or local community) for their treatment expenses and had therefore zero expenses, which were also removed.

### High Expenses

Some of the given answers about expenses per colony are quite high and above our calculated estimate. I decided to filter the dataset based on the arbitrary descision if the expenses per colony is double or more than the whole dataset extreme outlier (`r mmList$cost_upper$upper_limit` Euro), as defined in \@ref(eq:extreme-outliers). Further investigating the resulting list of `r nrow(mmList$cost_upper$data)` answers revealed that most of them did answer total expenses per operation and not expenses per colony as asked in the survey. As this is only an assumption, I removed from the outliers list participants which used Hyperthermia as treatment method, which could involve big investment, especially if it was only used for one year. As for the rest of the extreme outliers (*n* = `r nrow(mmList$cost_upper$new_data)`), I divided for each answers the expenses by the reported number of colonies going into winter. This means the manipulative impact was higher for participants which had high expenses above the limit and also reported a large number of colonies and less for small operations, were the expensive costs are possible true. The new calculated costs were updated in the cleaned dataset for further analysis.

```{=tex}
\begin{equation}
\begin{aligned}
  x >= (Q3 + 3 * IQR) * 2
\end{aligned}
(\#eq:extreme-outliers)
\end{equation}
```

### Final Data Count

After the afore mentioned cleanup steps, which filtered survey responses with valid answers for expenses per colony, the number of answer was reduced by around 21-24%, see table 

```{r reports, include=T}
cn <- c("Year", "Total [n]", "Answered [n]", "Percent [%]")
c <- "Number of participants answering the question for estimated treatment expenses per colony and total number of survey participants."
tab <- knitr::kable(
  mmList$reports %>%
    mutate(
      year = paste0("20", year)
    ),
  booktabs = TRUE,
  row.names = FALSE,
  col.names = cn,
  format = "markdown",
  caption = c
)
tab
rm(cn, c, tab)
```

## Statistics

The analysis of the data was carried out with R [@r2020], plotting and data manipulation was done mainly with Tidyverse [@tidyverse2019]. For full reproducibility the code and a list of all other packages are available on GitHub[^mm-2].

[^mm-2]: Github: <https://github.com/HannesOberreiter/treatment-expenses-austria>

As the main goal of the study is an exploratory data analyses (EDA) I try to rely mostly on descriptive statistics. The use of inference based statistics is minimized, as it should only be used for a predefined hypothesis and experimental design directly related to the research question. Though it is still common to underlay the results with statistics tests, I will report p-values from permutation generated from approximative multivariate Kruskal-Wallis test (Monte Carlo) [@hothorn2006] and report effect size $\eta^2_H$ (explained variance by the independent variable) with the equation \@ref(eq:effect) [@tomczak2014].

```{=tex}
\begin{equation}
\begin{aligned}
  \eta^2_H = \frac{H-k+1}{n-k}
\end{aligned}
(\#eq:effect)
\end{equation}
```

Loss rate and corresponding CI were compute with a quasibinominal generalized linear model (GZLM) and link "logit" function [@vanderzee2013]. To minimize the variation in the varroa control methods and their combination, the drone brood removal was removed, as it led to only low common combinations. For the analysis of the combination of different varroa control methods, a usage histogram for each method was generated and grouped into spring, summer, and winter. After that, a vector of all applied methods with at least 15 answers and without drone brood removal was generated to minimize calculation time and to generate statistically relevant results. Mapping of participants main wintering apiary location was done with modified k-means cluster search method [@oberreiter2020].

For the analysis of expenses and operation size, we grouped survey participants by the number of colonies wintered into following groups: 1-20, 21-50 and more than 50. Data distribution analysis was done with QQ-plots and boxplots. The operation factor question analysis (Migratory Beekeeper and Certified Organic Beekeeper) did include as possible answers "Yes", "No", "Uncertain". The category "Uncertain" and participants which did not answers the question were not used in statistical analysis.